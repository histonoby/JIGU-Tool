# JIGUツール (JIGU Tool)

> Streamlitで作成した、制御基板とステージコントローラをLAN経由で操作・テストするためのGUIアプリケーション

このツールは、カスタム仕様の制御基板およびシグマ光機製ステージコントローラ(FC-511)とのTCP/IP通信をシミュレート・実行するために開発されました。開発段階での通信シーケンスの検証や、単体テストを効率的に行うことを目的としています。

![JIGUツール アプリケーション画面](https://i.imgur.com/your-screenshot-url.png)
*(ここにアプリケーションのスクリーンショットを挿入してください)*

---
## 概要

本アプリケーションは、主に3つの機能タブから構成されています。

1.  **手動コマンド**: 制御基板に対し、任意のコマンドIDやデータを指定して、基本的なRead/Writeコマンドを手動で送受信します。
2.  **初期化シーケンス**: 制御基板の電源ON後の初期化フローをシミュレートします。アプリと模擬基板が相互にコマンドを送受信し、その状態遷移をリアルタイムで可視化します。
3.  **ラインスキャン**: 制御基板とステージコントローラ(FC-511)を連携させたラインスキャンシーケンスを実行します。基板からの要求に応じて、ステージへの原点復帰や相対移動指令を自動で発行します。

各シーケンス機能は、対応する模擬基板スクリプトと連携することで、実際のハードウェアがなくてもPC単体で完全な動作テストが可能です。

---
## 主な機能

* **GUIによる直感的な操作**: StreamlitによるWebベースのGUIで、IPアドレスや各種パラメータを簡単に入力・設定できます。
* **カスタムTCP/IPパケット生成**: 12バイトの独自仕様コマンドパケットを自動生成して送信します。
* **非同期シーケンスのシミュレーション**: 複数のターミナルで模擬基板を動作させることで、複雑な非同期通信のテストが可能です。
* **ステージコントローラ連携**: シグマ光機FC-511のLANコマンド仕様に準拠したステージ制御（原点復帰、相対移動）を実装しています。
* **モジュール化されたテスト環境**: 各機能タブが独立しており、対応する模擬スクリプトを切り替えるだけでテスト対象を簡単に変更できます。

---
## 動作環境

* Python 3.8 以上
* 以下のPythonライブラリ (`requirements.txt`に記載)
  * streamlit
  * pandas

---
## 準備 (セットアップ)

1.  **リポジトリをクローン**
    ```bash
    git clone [https://github.com/your-username/jigu-tool.git](https://github.com/your-username/jigu-tool.git)
    cd jigu-tool
    ```

2.  **Python仮想環境の作成と有効化 (推奨)**
    ```bash
    # Linux / macOS
    python3 -m venv venv
    source venv/bin/activate

    # Windows
    python -m venv venv
    .\venv\Scripts\activate
    ```

3.  **必要なライブラリをインストール**
    以下の内容で `requirements.txt` ファイルを作成し、`pip`でインストールします。
    
    **`requirements.txt`**:
    ```txt
    streamlit
    pandas
    ```
    
    **インストールコマンド**:
    ```bash
    pip install -r requirements.txt
    ```

---
## 使い方

本ツールは、**メインアプリ (`app.py`)** と、テストしたい機能に対応する **模擬基板スクリプト** の2つを、それぞれ別のターミナルで起動して使用します。

**同時に起動できる模擬基板スクリプトは1種類だけです。**

### 1. 手動コマンド (Tab1) のテスト

単純なRead/Writeコマンドのテストを行います。

1.  **ターミナル1**: `mock_server.py` を起動します。
    ```bash
    python mock_server.py
    ```
    `IPアドレス 127.0.0.1:60200 で待機中...` と表示されます。

2.  **ターミナル2**: `app.py` を起動します。
    ```bash
    streamlit run app.py
    ```
3.  ブラウザで「手動コマンド」タブを開き、ポートが `60200` になっていることを確認してコマンドを送信します。

### 2. 初期化シーケンス (Tab2) のテスト

1.  **ターミナル1**: `mock_board_init.py` を起動します。
    ```bash
    python mock_board_init.py
    ```
2.  **ターミナル2**: `app.py` を起動します。
    ```bash
    streamlit run app.py
    ```
3.  ブラウザで「初期化シーケンス」タブを開き、「待機開始」ボタンを押してから、`mock_board_init.py`の処理を進めます。（`mock_board_init.py`は自動で処理を開始します）

### 3. ラインスキャン (Tab3) のテスト

1.  **ターミナル1**: `mock_board_linescan.py` を起動します。
    ```bash
    python mock_board_linescan.py
    ```
2.  **ターミナル2**: `app.py` を起動します。
    ```bash
    streamlit run app.py
    ```
3.  ブラウザで「ラインスキャン」タブを開き、「スキャン開始」ボタンを押すとシーケンスが始まります。
    * **注意**: 実際のステージコントローラ(FC-511)をLANに接続し、IPアドレス等を設定すると、物理的なステージ動作も連動してテストできます。

---
## ファイル構成

```
.
├── app.py                  # Streamlitで作成したメインGUIアプリケーション
├── mock_server.py          # 「手動コマンド」タブ用のシンプルな模擬サーバー
├── mock_board_init.py      # 「初期化シーケンス」をシミュレートする模擬制御基板
├── mock_board_linescan.py  # 「ラインスキャン」をシミュレートする模擬制御基板
├── requirements.txt        # 依存ライブラリ一覧
└── README.md               # このファイル
```

---
## 今後の課題 (TODO)

* ステージコントローラの詳細なステータス監視（移動完了ポーリングなど）の実装
* IPアドレスやポート番号などの設定情報をファイルに保存・読込する機能
* スキャンデータの簡易的なグラフ表示機能
* ログをファイルに出力する機能